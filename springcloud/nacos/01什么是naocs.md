[TOC]

# 什么是Nacos

官方：一个更易于构建云原生应用的动态**服务发现（Naocs Discovery）**、**服务配置（Nacos Config）**和服务管理平台。

集 **注册中心+配置中心+服务管理** 平台

Nacos的关键特性包括：

- 服务发现和服务健康监控
- 动态配置服务
- 动态DNS服务
- 服务及其元数据管理



# Nacos注册中心

管理所有微服务，解决微服务之间调用关系错综复杂，难以维护的问题。

## 注册中心演变及其设计思想

**以下展示注册中心的由来：**

起初，服务的地址是直接写在代码里面的，如果要修改服务地址就需要在代码中手动修改，如果有很多的地址需要维护的话，操作起来就很麻烦。而且服务一旦多了起来，就需要把服务进行集群部署，那么系统的复杂性就提高了。

![nacos (2)](https://fastly.jsdelivr.net/gh/lqyspace/mypic@master/img1/202406011655075.png)

然后，人们开始考虑把服务地址放在一个注册表里，在注册表中维护服务地址信息。当服务多了起来以后，就需要对表进行水平扩充，并且当时并没有很好的负载均衡机制，微服务架构还没有诞生，如果某个服务地址宕机，维护起来也是比较麻烦的。

![nacos (3)](https://fastly.jsdelivr.net/gh/lqyspace/mypic@master/img1/202406011656453.png)

因此，人们开始使用nginx作为负载均衡的工具。需要把服务列表配置在nginx当中。首先，如果某一条服务地址宕机了，nginx是不能进行健康检查的，无法将这条宕机的服务地址排除在外，当然也可以使用第三方工具的来实现健康检查，但是配置起来也是比较麻烦的。其次，如果将成百上千个服务地址配置在nginx配置文件当中，对于运维来说简直就是灾难。（此为服务端的负载均衡）

![nacos (4)](https://fastly.jsdelivr.net/gh/lqyspace/mypic@master/img1/202406011657307.png)

当微服务开始流行起来，注册中心就可以用来代替Nginx。注册中心相当于是一个MySQL数据表，服务在启动时都会去注册中心注册服务，然后从注册中心获取相应的服务列表，再从服务列表中选择某一台机器获取服务。

![nacos (6)](https://fastly.jsdelivr.net/gh/lqyspace/mypic@master/img1/202406011724597.png)

为了解决上面的问题，在注册中心加入心跳接口。在微服务中加入定时任务，定时向注册中心发送心跳，如果注册中心超过一定的时间阈值没有收到服务心跳，则认为该服务已下线，则把该服务标记为已下线。同时如果服务stop，也会把该信息通知给注册中心，让注册中心把该服务下线。例如，在会员服务内部还有一个定时任务，定时拉取订单服务列表缓存到客户端（指的是会员服务），从而保证客户端使用的都最新的服务列表，这个称之为**客户端的负载均衡**。

![nacos (7)](https://fastly.jsdelivr.net/gh/lqyspace/mypic@master/img1/202406011801864.png)

## Nacos注册中心架构

