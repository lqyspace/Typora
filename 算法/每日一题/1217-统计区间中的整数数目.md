# 2276-统计区间中的整数数目

[2276-统计区间中的整数数目](https://leetcode.cn/problems/count-integers-in-intervals/description/?envType=daily-question&envId=2023-12-16)，难度困难

![image-20231216234457772](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed202312162344805.png)

题解：**平衡二叉搜索树**

用一棵平衡二叉搜索树维护插入的区间，树中的区间两两不相交。当插入一个新的区间时，需要查出所有与待插入区间有重合的整数区间，将这些区间合并成一个新的区间插入到树中。区间包含两个属性，左端点$l$和右端点$r$，其中左端点在树中参与排序，当插入一个新的区间$add(left, right)$时，需要找到树中刚好满足：$left'<=right \& right'>=left$的区间`internal`，如果不满足这个条件那么就说明它们并不存在重合。同时用一个整数`cnt`维护树中间隔覆盖的整数。

代码：

```java
class CountIntervals {
    TreeMap<Integer, Integer> tree = null;
    int cnt = 0;
    public CountIntervals() {
        tree = new TreeMap<>();
    }
    
    public void add(int left, int right) {
        Map.Entry<Integer, Integer> map = tree.floorEntry(right);
        while(map!=null && map.getValue()>=left){
            int l = map.getKey(), r = map.getValue();
            left = Math.min(left, l);
            right = Math.max(right, r);// 说明有交叠
            cnt -= (r - l + 1);
            tree.remove(l);
            map = tree.floorEntry(right);
        }
        cnt += (right - left + 1);
        tree.put(left, right);
    }
    
    public int count() {
        return cnt;
    }
}

/**
 * Your CountIntervals object will be instantiated and called as such:
 * CountIntervals obj = new CountIntervals();
 * obj.add(left,right);
 * int param_2 = obj.count();
 */
```

