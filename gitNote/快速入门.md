[TOC]

# Git的基本用法

## 入门

使用Git前，需要先建立一个仓库（repository）。您可以使用一个已经存在的目录作为Git仓库或创建一个空目录.

使用您当前的目录作为一个Git仓库，首先进行初始化。

```javascript
git init
```

使用我们指定的目录作为Git仓库

```javascript
git init newrepo
```

**以下的操作是在Git仓库的根目录下进行。**

> 添加新文件

```java
git add filename
```

> 提交版本

现在我们已经添加了这些文件，我们希望他们能够真正的保存在Git仓库中。

为此，我们将其提交到仓库中。

```java
git commit -m "commit info"
```

如果您不使用 `-m` ,会出现编辑器让你写自己的注释信息。

当我们修改了很多的文件，而不想一个个的 `add` ，想 `commit` 自动提交本地修改，我们可以使用 `-a` 来标识。

```java
git commit -a -m "commit info"
```

git commit 命令的 -a 选项可将所有 **被修改或者已删除的且已经被git管理的文档** 提交到仓库中。

==前往注意，-a不会造成新文件被提交，只能修改==

> 发布版本

我们先从服务器克隆一个库并上传。

```java
git clone https://github.com/lqyspace/Typora.git
```

现在我们修改之后可以进行推送到服务器。

```java
git push https://github.com/lqyspace/Typora.git
```

```
git push origin 分支名称
```



> 取回更新

如果您已经进行了上面的push，下面的命令表示，当前分支自动与唯一一个追踪分支进行合并

```java
git pull
```

从非默认位置更新到指定的url。

```java
git pull https://github.com/lqyspace/Typora.git
```

> 删除

如果你想从Git仓库中删除文件，我们使用 rm：

```java
git rm file
```

> 分支与合并

查看当前文件的分支

```bash
git branch
```

分支在本地完成，速度快。要创建一个新分支，我们使用 branch 命令。

```java
git branch test
```

branch 不会把我们带入一个新分支，只是创建一个新的分支，所以我们可以使用 checkout 命令来切换分支。

```java
git checkout test
```

第一个分支，或主分支。我们称之为“master”。

```java
git checkout master
```

对其他分支的更改不会反映在主分支上。如果想将更改提交到主分支上，则需切回master分支，然后使用合并。

```java
git checkout master
git merge test # 把test的代码切换到master上
```

如果报错：`fatal: refusing to merge unrelated histories`

接着执行

```
git pull origin master –allow-unrelated-histories
```

报`fatal: couldn't find remote ref –allow-unrelated-histories`

接着执行

```
git merge master --allow-unrelated-histories 
```

![image-20221122205345650](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202211222053376.png)

如果您想删除本地分支，我们使用 `-d` 标识。

```java
git branch -d test
```

感觉离完成接近了一步
继续

```
git checkout master
```

```
git merge main
```

![image-20221122205432540](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202211222054586.png)

好多了
继续

```
git push
```

![image-20221122205459365](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202211222054439.png)

好更多了 如上图
但没推上去， 是因为公司提交代码需要引用工单，我着急忘了引，被拒绝了
那现在需要重新写一下提交注释
继续操作：

对之前最近的commit 提交进行修改，而且是没有push到远程的

```
git commit --amend
```

这里会进入 vim编辑器 嗯我记得就叫vim
这里需要按键盘 i 键，进入编辑模式，然后就可以输入注释，引用工单了，输入完按键盘 Esc ，推出编辑，然后在英文输入法下，打 :wq 就退出了。

```
git push
```

完成

## 删除远程main分支

我还想把远程main分支删了，只留master分支

查看所有分支

```
git branch -a
```

![image-20221122205615540](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202211222056585.png)

删除远程main分支

```
git push origin --delete main
```

完工

> 其他基本功能

将文件重命名

```java
git mv readme.txt readme.md
```

查看Git仓库状态

```
git status
```

---

## Git push 命令用法

git push 是 Git 常用的命令，起作用是将本地分支的更新推送到远程主机。



> git push 格式

git push 的格式和 git pull 类似：

```java
git push <远程主机> <本地分支>:<远程分支>
```

==注意==：

分支推送的写法是：<来源地>：<目的地>，所以 git pull 是 <远程分支>：<本地分支>，而 git push 是 <本地分支>：<远程分支>。

如果省略远程分支名，则表示将本地分支推送给与之存在“追踪关系”的远程分支（通常两者同名），如果该远程分支不存在，则会被新建。



**git push 常见用法：**

```
git push origin master
```

该命令的作用是将本地的 **master** 分支推送给 **origin** 主机的 **master** 分支。如果后者不存在，则会被新建。

如果省略本地分支名，则表示删除指定的远程分支，因为这等同于将一个空的本地分支推送给远程分支。

```
git push origin :master
等同于
git push origin --delete master
```

上面的命令表示删除 **origin** 主机的对应分支。如果当前分支只有一个追踪分支，那么主机名可以省略。

```
git push
```

如果当前分支与多个主机存在追踪关系，则可以使用 **-u** 选项制定一个默认主机，这样后面就可以不加任何参数使用 git push。

```
git push -u origin master
```

上面的命令将本地的 master 分支推送给 origin 主机，同时指定 origin 为默认主机，后面就可以不加任何参数使用 git push了。



不带任何参数的 git push，默认只推送当前分支，这叫 simple 方式。此外，还有一种 matching 方式，会推送所有有对应关系的远程分支的本地分支。

Git2.0 版本之前，默认采用 matching 方法，现在改为默认采用 simple 方式。如果要修改这个设置，可以采用 git config 命令。

```
git config --global push.default matching
或者
git config --global push.default simple
```

还有一种情况就是，不管是否存在对应的远程分支，将本地的所有分支都推送到远程分支，这时需要使用 -**all** 选项。

```
git push -all origin
```

上面的命令表示，将所有的本地分支推送到 origin 主机。



如果远程主机的版本比本地版本更新，推送Git会报错，要求现在本地做 git pull 合并差异，然后在推送到远程主机。这时如果你一定要推送，可使用 **--force** 选项。

```
git push --force origin
```



最后使用 git push 不会推送标签（tag），除非使用 **--tags** 选项。

```
git push origin --tags
```



有时候当远程分支被删掉以后，用 git branch -a 你还可以看到本地还有 remote/origin/xxx 这个分支，那么你可以使用 git fetch -p 这个命令帮你同步最新的远程分支，并删掉本地被删掉的远程分支。

























