# 虚拟主机与域名解析

## 域名、dns、ip地址的关系



## 浏览器、Nginx与http协议



![image-20220522164511164](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202205221645355.png)

tcp/ip 是基础协议，http 是在tcp的基础上写的协议，https是在http的基础上将数据加密的协议。

## 虚拟主机原理

- 将一台主机虚拟出更多的主机
- 比如：多个域名对应一个ip地址：指向不同站点的目录就可以
  - 目录 -> atguigu.com -> /root/www/atguigu.com
  - 目录 -> vod.atguigu.com -> /root/www/vod.atguigv.com
- 

## 域名解析与泛域名解析实战

域名解析：在自己的主机上的尝试：

- 修改 C:\Windows\System32\drivers\etc 路径下的 hosts 文件
- 在里面添加：（假设你的虚拟机的Ubuntu的ip为：192.168.159.129）
  - 192.168.159.129 ubuntulqy.com



域名解析规则：

- A：将域名指向一个IPV4地址
- CNAME：将域名指向另外一个域名上
- AAAA：将域名解析到IPV6地址
- NS：姜子域名指定其他DNS服务器解析
- MX：将域名指向邮件服务器地址

## 域名解析相关企业项目实战技术架构



### 多用户二级域名

1、添加记录时：

- 泛解析：*.beistu.xyz

![ ](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202205222026924.png)

### 短网址

![image-20220522202552880](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202205222025050.png)

用户输入一个短网址，经过Nginx反向代理，在短网址运维系统中匹配出真实的网址并返回。

### httpdns

![](https://raw.githubusercontent.com/lqyspace/mypic/master/PicBed/202205222033270.png)

## Nginx中的虚拟主机配置

> 多站点配置

```nginx
server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   /www/www;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }

    server {
        listen       8088;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   /www/vod;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }
```



# ServerName匹配规则

> **完整匹配、通配符匹配：**

```
listen 80;
server_name stu.beistu.xyz status.beistu.xyz; # 可以在同一个server_name里匹配多个域名

listen 80;
server_name www.beistu.xyz;

listen 80;
server_name *.beistu.xyz;
```

域名匹配的时候有先后顺序，如果先匹配上，就不往后匹配了。

如果以上的端口号都是80端口，那么：

​	除了 stu.beistu.xyz， status.beistu.xyz，www.beistu.xyz  以外，剩下的都访问在 *.beistu.xyz 。

> **通配符结束匹配：**

```
listen 80;
server_name www.beistu.xyz;


listen 80;
server_name www.beistu.*;
```

也遵循先匹配上，后面的就不匹配了。

> 正则匹配

适合二级域名配备。

```
listen 80;
server_name www.beistu.xyz;


listen 80;
server_name ~^[0-9]+\.beistu\.xyz$;
```

也遵循先匹配上，后面的就不再进行匹配了。



























