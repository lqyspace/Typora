[TOC]

# volatile

## 1 几个基本概念

### 1.1 内存可见性

JMM有一个主内存，每个线程都有自己私有的工作内存，工作内存中保存了一些变量在主内存的拷贝。

**内存可见性，指的是线程之间的可见性，当一个线程修改了共享变量时，另一个线程可以读到这个修改后的值。**



### 1.2 重排序

 为优化程序性能，对原有的指令执行顺序进行优化重新排序。重排序可能发生在多个阶段，比如编译重新，CPU重排序等。



### 1.3 happens-before规则

是一个程序员使用的规则，只要程序员在写代码的时候能够遵循happens-before规则，JVM就能够保证指令在多线程之间的顺序符合程序员的预期。



## 2 volatile内存语义

在Java中，volatile关键字有特殊的内存语义，volatile主要有以下两个功能：

- 保证变量的**内存可见性**
- 禁止volatile变量与普通变量重排序（JSR133提出，Java5开始才有这个“增强的volatile内存语义”）



### 2.1 内存可见性

